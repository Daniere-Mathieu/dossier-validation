### C17 - Consommer une API de manière sécurisée en s’appuyant sur des mécanismes d’identification et d’authentification robustes afin d’intégrer des sources de données et des services tiers

Pour consommer une API de manière sécurisée, il est primordial de mettre en place des mécanismes d’identification et d’authentification robustes. Cette approche permet de garantir l'intégrité et la confidentialité des données échangées avec des sources de données et des services tiers.

#### Identification et Authentification

L’identification consiste à vérifier l’identité de l’utilisateur ou du système qui souhaite accéder à l’API. L’authentification, quant à elle, consiste à prouver cette identité, généralement via des informations d’identification telles qu'un mot de passe ou un jeton d'accès. Les mécanismes suivants peuvent être utilisés :

1. **OAuth 2.0** : Ce protocole permet d'accorder un accès limité aux ressources d’un serveur sans partager les identifiants entre le client et le serveur. Les jetons d’accès (access tokens) délivrés après l’authentification peuvent être utilisés pour accéder aux ressources protégées.

2. **JWT (JSON Web Tokens)** : Les JWT sont des jetons utilisés pour vérifier les requêtes authentifiées. Ils contiennent des informations encodées et signées qui permettent de valider l'identité de l'utilisateur. Les JWT sont souvent utilisés en conjonction avec OAuth 2.0.

3. **API Keys** : Les clés API sont des identifiants uniques qui authentifient les requêtes à une API. Elles sont simples à mettre en œuvre mais doivent être gérées avec soin pour éviter les abus.

#### Bonnes pratiques de sécurité

Pour assurer une consommation sécurisée des API, il est essentiel de suivre les bonnes pratiques de sécurité suivantes :

1. **Utilisation de HTTPS** : Toutes les communications avec l'API doivent être chiffrées en utilisant HTTPS afin de protéger les données en transit contre les interceptions et les attaques de type Man-in-the-Middle (MITM).

2. **Validation des entrées** : Valider toutes les données d'entrée provenant des utilisateurs et des sources externes pour éviter les injections SQL, XSS, et autres types d'attaques par injection.

3. **Limitation des taux de requêtes (Rate Limiting)** : Mettre en place des mécanismes de limitation des requêtes pour protéger l'API contre les abus et les attaques par déni de service (DoS).

4. **Logs et surveillance** : Garder des traces des accès et des erreurs pour détecter et répondre rapidement aux incidents de sécurité.

#### Intégration avec des services tiers

Pour intégrer des sources de données et des services tiers de manière sécurisée :

1. **Configuration des permissions** : Assurer que chaque service tiers dispose uniquement des permissions nécessaires pour accomplir ses tâches spécifiques.

2. **Utilisation des scopes** : Avec OAuth 2.0, définir des scopes pour limiter l’accès aux ressources uniquement à ce qui est nécessaire pour le service tiers.

3. **Revocation des jetons** : Mettre en place un mécanisme pour révoquer les jetons d'accès en cas de compromission ou de changement des autorisations.

### Exemple d'implémentation

Voici un exemple simplifié d'authentification avec OAuth 2.0 en utilisant un jeton d'accès pour consommer une API de manière sécurisée :

```typescript
import axios from "axios";

const apiUrl = "https://api.example.com/data";
const tokenUrl = "https://auth.example.com/oauth/token";
const clientId = "your-client-id";
const clientSecret = "your-client-secret";

async function getAccessToken() {
  const response = await axios.post(tokenUrl, {
    client_id: clientId,
    client_secret: clientSecret,
    grant_type: "client_credentials",
  });
  return response.data.access_token;
}

async function fetchData() {
  const accessToken = await getAccessToken();
  const response = await axios.get(apiUrl, {
    headers: {
      Authorization: `Bearer ${accessToken}`,
    },
  });
  console.log(response.data);
}

fetchData();
```

Dans cet exemple, nous obtenons un jeton d'accès à partir d'un serveur d'autorisation OAuth 2.0 et utilisons ce jeton pour authentifier une requête à une API.
